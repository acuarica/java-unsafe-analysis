<project name="java-unsafe-analysis" default="compile" basedir=".">
	<description>Java Unsafe Analysis</description>
	<property name="src" location="src" />
	<property name="resources" location="src" />
	<property name="lib" location="lib" />
	<property name="build" location="build" />
	<property name="db" location="db" />
	<property name="repo" location="${db}/repo" />
	<property name="mirror.1" value="http://mirrors.ibiblio.org/maven2" />
	<property name="mirror.2" value="http://maven.antelink.com/content/repositories/central" />
	<property name="mirror.3" value="http://artifactory.theomega.org/artifactory/repo" />
	<property name="mirror.4" value="http://scalasbt.artifactoryonline.com/scalasbt/repo" />
	<property name="mirror.5" value="http://repo.jfrog.org/artifactory/simple/libs-release-bintray" />
	<property name="gzindexurl" value="${mirror.1}/.index/nexus-maven-repository-index.gz" />
	<property name="gzindexpath" location="${db}/nexus-maven-repository-index.gz" />
	<property name="indexpath" location="${db}/nexus-maven-repository-index" />
	<property name="urilist" location="${db}/uri.list" />
	<property name="sessionlist" location="${db}/session.list" />
	<property name="noartifactstodownload.small" value="10000" />
	<property name="downloadlog" location="${db}/download.log" />
	<!-- mavendb.artifactspath=.db/artifacts.csv  -->
	<path id="lib">
		<fileset dir="${lib}">
			<include name="*.jar" />
		</fileset>
	</path>
	<target name="mkdirbuild">
		<mkdir dir="${build}" />
	</target>
	<target name="mkdirdb" description="create the dir">
		<mkdir dir="${db}" />
	</target>
	<target name="getgzindex" depends="mkdirdb">
		<exec executable="aria2c">
			<arg value="--dir=/" />
			<arg value="--max-concurrent-downloads=16" />
			<arg value="--auto-file-renaming=false" />
			<arg value="--conditional-get=true" />
			<arg value="--out=${gzindexpath}" />
			<arg value="${gzindexurl}" />
		</exec>
	</target>
	<target name="getindex" depends="getgzindex">
		<gunzip src="${gzindexpath}" dest="${indexpath}" />
	</target>
	<target name="compile" depends="mkdirbuild" description="asdfasdf">
		<javac includeantruntime="false" srcdir="${src}" destdir="${build}">
			<classpath refid="lib" />
		</javac>
	</target>
	<target name="buildindexdb" depends="compile">
		<java classname="ch.usi.inf.sape.unsafeanalysis.BuildIndexDb" classpath="${build}:${resources}">
			<classpath refid="lib" />
			<arg value="${indexpath}" />
			<arg value="${db}/hola.db" />
		</java>
	</target>
	<target name="buildurilist" depends="compile,getindex">
		<java classname="ch.usi.inf.sape.unsafeanalysis.BuildUriList" classpath="${build}:${resources}" fork="true">
			<classpath refid="lib" />
			<assertions>
				<enable />
			</assertions>
			<arg value="${indexpath}" />
			<arg value="${urilist}" />
			<arg value="${noartifactstodownload.small}" />
			<arg value="${mirror.1}" />
			<arg value="${mirror.2}" />
			<arg value="${mirror.3}" />
			<arg value="${mirror.4}" />
			<arg value="${mirror.5}" />
		</java>
	</target>
	<target name="getartifacts">
		<exec executable="aria2c">
			<arg value="--dir=${repo}" />
			<arg value="--max-concurrent-downloads=16" />
			<arg value="--auto-file-renaming=false" />
			<arg value="--input-file=${urilist}" />
			<arg value="--save-session=${sessionlist}" />
			<arg value="--conditional-get=true" />
			<arg value="--log=${downloadlog}" />
		</exec>
	</target>
	<target name="analysemaven" depends="compile">
		<java classname="ch.usi.inf.sape.unsafeanalysis.AnalyseMaven" classpath="${build}:${resources}">
			<classpath refid="lib" />
			<arg value="${indexpath}" />
		</java>
	</target>
	<target name="jdk8" depends="compile">
		<java classname="ch.usi.inf.sape.unsafeanalysis.AnalyseJdk8" classpath="${build}:${resources}">
			<classpath refid="lib" />
		</java>
	</target>
	<target name="build" depends="compile">
		<java classname="ch.usi.inf.sape.unsafe.maven.Main$Build" classpath="${build}:${resources}" fork="true">
			<classpath refid="lib" />
			<assertions>
				<enable />
			</assertions>
		</java>
	</target>
	<target name="download" depends="compile">
		<java classname="ch.usi.inf.sape.unsafe.maven.Main$Download" classpath="${build}:${resources}" fork="true">
			<classpath refid="lib" />
			<assertions>
				<enable />
			</assertions>
		</java>
	</target>
	<target name="analyse" depends="compile">
		<java classname="ch.usi.inf.sape.unsafe.maven.Main$Analyse" classpath="${build}:${resources}:lib/lucene-core-2.4.1.jar:lib/asm-all-5.0.3.jar" fork="true">
			<assertions>
				<enable />
			</assertions>
		</java>
	</target>
	<target name="graph" depends="compile">
		<java classname="ch.usi.inf.sape.unsafe.maven.Main$Graph" classpath="${build}::${resources}:lib/lucene-core-2.4.1.jar:lib" fork="true">
			<assertions>
				<enable />
			</assertions>
		</java>
	</target>
	<target name="cp">
		<copy file="${db}/unsafe-maven.csv" todir="analysis/csv" />
	</target>
	<target name="clean">
		<delete dir="${build}" />
	</target>
</project>
